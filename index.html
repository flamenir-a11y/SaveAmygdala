<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Amygdala Escape Room</title>
    <!-- 注转 Tailwind CSS 注爪 -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Heebo:wght@300;400;700;900&display=swap');
        body { font-family: 'Heebo', sans-serif; }
    </style>
</head>
<body class="bg-slate-900 text-white">
    <div id="root"></div>

    <!-- 注转 拽 -->
    <script type="module">
        import React, { useState, useEffect, useRef } from 'https://esm.sh/react@18.2.0';
        import { createRoot } from 'https://esm.sh/react-dom@18.2.0/client';
        import { 
            AlertTriangle, Activity, Brain, Heart, Wind, ShieldAlert, 
            CheckCircle, XCircle, Lock, Eye, Zap, Thermometer, Meh, 
            Smile, Frown, Lightbulb, TrendingUp, TrendingDown, Layers 
        } from 'https://esm.sh/lucide-react@0.263.1';

        const AmygdalaEscapeRoom = () => {
            // 住住 专砖
            const [gameState, setGameState] = useState('intro'); // intro, hijack, regulation, success, fail
            const [timeLeft, setTimeLeft] = useState(45); // 砖注 注爪专 砖: 45 砖转
            const [panicLevel, setPanicLevel] = useState(0);
            const [answeredQuestions, setAnsweredQuestions] = useState([]); 
            const [feedback, setFeedback] = useState('');
            
            // 砖砖 -ref   转 专 砖 驻拽 注 转砖转
            const feedbackTimeoutRef = useRef(null);

            // 10 转专 砖 砖 专砖转 注 专 住
            const challenges = [
                {
                    id: 'q1',
                    visual: '', // 驻
                    icon: React.createElement(Eye, { className: "w-5 h-5" }),
                    correctOption: '驻',
                    options: ['砖', '驻', '注爪']
                },
                {
                    id: 'q2',
                    visual: '', // 注住
                    icon: React.createElement(Thermometer, { className: "w-5 h-5" }),
                    correctOption: '注住',
                    options: ['注住', '注', '驻转注']
                },
                {
                    id: 'q3',
                    visual: 'ぎ', // 注
                    icon: React.createElement(Meh, { className: "w-5 h-5" }),
                    correctOption: '注',
                    options: ['转', '注', '']
                },
                {
                    id: 'q4',
                    visual: '', // 驻转注
                    icon: React.createElement(Zap, { className: "w-5 h-5" }),
                    correctOption: '驻转注',
                    options: ['', '', '驻转注']
                },
                {
                    id: 'q5',
                    visual: '', // 注爪
                    icon: React.createElement(Frown, { className: "w-5 h-5" }),
                    correctOption: '注爪',
                    options: ['砖', '注爪', '砖转']
                },
                {
                    id: 'q6',
                    visual: '', // 砖
                    icon: React.createElement(TrendingDown, { className: "w-5 h-5" }),
                    correctOption: '砖',
                    options: ['砖', '砖', '驻']
                },
                {
                    id: 'q7',
                    visual: '', // 砖
                    icon: React.createElement(ShieldAlert, { className: "w-5 h-5" }),
                    correctOption: '砖',
                    options: ['砖', '', '注']
                },
                {
                    id: 'q8',
                    visual: '', // 注
                    icon: React.createElement(Lightbulb, { className: "w-5 h-5" }),
                    correctOption: '注',
                    options: ['注', '注住', '砖']
                },
                {
                    id: 'q9',
                    visual: '', // 
                    icon: React.createElement(Layers, { className: "w-5 h-5" }),
                    correctOption: '',
                    options: ['/砖', '', '/专']
                },
                {
                    id: 'q10',
                    visual: 'コ', // /砖
                    icon: React.createElement(Smile, { className: "w-5 h-5" }),
                    correctOption: '砖/',
                    options: ['砖', '砖', '砖/']
                }
            ];

            // 专 拽 砖 祝 住转
            useEffect(() => {
                let interval;
                if ((gameState === 'hijack' || gameState === 'regulation') && timeLeft > 0) {
                    interval = setInterval(() => {
                        setTimeLeft((prev) => prev - 1);
                        // 注转 专转 驻拽 专拽 砖 祝 转
                        if (gameState === 'hijack') {
                            setPanicLevel((prev) => (prev + 1) % 10);
                        }
                    }, 1000);
                } else if (timeLeft === 0 && (gameState === 'hijack' || gameState === 'regulation')) {
                    setGameState('fail');
                }
                return () => clearInterval(interval);
            }, [gameState, timeLeft]);

            // 拽转 转 爪
            useEffect(() => {
                if (answeredQuestions.length === challenges.length && gameState === 'regulation') {
                    setTimeout(() => setGameState('success'), 500);
                }
            }, [answeredQuestions, gameState]);

            const handleStart = () => {
                setGameState('hijack');
                setTimeLeft(45);
                setAnsweredQuestions([]);
                setFeedback('');
            };

            const handleTrapClick = (type) => {
                setFeedback(`转转 ${type} 砖! 注专转 拽拽 注 拽. 注砖 : -5 砖转.`);
                setTimeLeft((prev) => Math.max(0, prev - 5));
                
                if (feedbackTimeoutRef.current) clearTimeout(feedbackTimeoutRef.current);
                feedbackTimeoutRef.current = setTimeout(() => setFeedback(''), 1500);
            };

            const activateCortex = () => {
                setGameState('regulation');
                setFeedback('拽专拽住 驻注. 砖 转 转 10 专砖转 专转! 专 砖 专抓.');
                
                if (feedbackTimeoutRef.current) clearTimeout(feedbackTimeoutRef.current);
                feedbackTimeoutRef.current = setTimeout(() => setFeedback(''), 3000);
            };

            const handleAnswer = (challengeId, selectedOption, correctOption) => {
                // 拽 专 拽  拽  注 
                if (feedbackTimeoutRef.current) clearTimeout(feedbackTimeoutRef.current);

                if (selectedOption === correctOption) {
                    if (!answeredQuestions.includes(challengeId)) {
                        setAnsweredQuestions(prev => [...prev, challengeId]);
                        setFeedback(' !  转拽专专转...');
                        //  转爪 拽爪专 -750 砖转 转砖 专 转专
                        feedbackTimeoutRef.current = setTimeout(() => setFeedback(''), 750);
                    }
                } else {
                    setFeedback(' 专砖 砖.  注 驻注. 注砖 : -3 砖转.');
                    setTimeLeft((prev) => Math.max(0, prev - 3));
                    feedbackTimeoutRef.current = setTimeout(() => setFeedback(''), 1000);
                }
            };

            return React.createElement('div', { className: "min-h-screen bg-slate-900 text-white font-sans overflow-hidden flex flex-col items-center justify-center p-4" },
                // Intro Screen
                gameState === 'intro' && React.createElement('div', { className: "max-w-2xl w-full bg-slate-800 p-8 rounded-xl shadow-2xl border border-blue-500 text-center space-y-6" },
                    React.createElement('div', { className: "flex justify-center mb-4" },
                        React.createElement(Brain, { size: 64, className: "text-blue-400 animate-pulse" })
                    ),
                    React.createElement('h1', { className: "text-3xl font-bold text-blue-300" }, "注专转 拽专转 专砖转: 住住 转拽"),
                    React.createElement('p', { className: "text-lg text-slate-300" },
                        "专  专 拽专 砖 .", React.createElement('br'),
                        "专  专 转 \"祝 \"  砖 注 注  砖 拽 砖 10 专砖转 砖   (45 砖转)."
                    ),
                    React.createElement('button', {
                        onClick: handleStart,
                        className: "px-8 py-3 bg-blue-600 hover:bg-blue-700 rounded-lg text-xl font-bold transition-all transform hover:scale-105 shadow-lg"
                    }, "转 住爪 (45 砖转)")
                ),

                // Hijack Screen
                (gameState === 'hijack' || gameState === 'regulation') && React.createElement('div', { className: `max-w-6xl w-full relative ${gameState === 'hijack' && panicLevel % 2 === 0 ? 'translate-x-1' : '-translate-x-1'}` },
                    
                    // Status Bar
                    React.createElement('div', { className: "bg-slate-700 p-4 mb-4 rounded-xl border-b-4 border-blue-500 flex justify-between items-center sticky top-4 z-20 shadow-xl" },
                        React.createElement('div', { className: "flex items-center gap-3" },
                            React.createElement('span', { className: `text-2xl font-bold ${answeredQuestions.length === challenges.length ? 'text-green-400' : 'text-blue-400'}` },
                                `住住 住转: ${answeredQuestions.length}/${challenges.length}`
                            ),
                            React.createElement('div', { className: "w-40 h-3 bg-slate-600 rounded-full overflow-hidden" },
                                React.createElement('div', {
                                    className: "h-full bg-green-500 transition-all duration-500",
                                    style: { width: `${(answeredQuestions.length / challenges.length) * 100}%` }
                                })
                            )
                        ),
                        React.createElement('div', { className: "flex items-center gap-2" },
                            React.createElement('span', { className: "text-xl text-slate-300" }, " 砖转专:"),
                            React.createElement('div', { className: "text-3xl font-mono font-bold text-red-500 bg-black px-4 py-1 rounded shadow-inner" },
                                `00:${timeLeft < 10 ? `0${timeLeft}` : timeLeft}`
                            )
                        )
                    ),

                    // Content Area
                    React.createElement('div', { className: "bg-slate-800 border-4 border-red-600 p-6 rounded-xl shadow-[0_0_50px_rgba(220,38,38,0.5)]" },
                        
                        // Hijack Phase
                        gameState === 'hijack' && React.createElement(React.Fragment, null,
                            React.createElement('div', { className: "flex justify-between items-center mb-6 border-b border-red-800 pb-4" },
                                React.createElement('div', { className: "flex items-center gap-3" },
                                    React.createElement(AlertTriangle, { size: 40, className: "text-red-500 animate-bounce" }),
                                    React.createElement('h2', { className: "text-3xl font-black text-red-500 tracking-widest uppercase" }, "转专转 祝 !")
                                )
                            ),
                            React.createElement('p', { className: "text-xl text-red-300 mb-8 text-center font-bold animate-pulse" },
                                " ! 注  转拽! 专砖转 转 转!"
                            ),
                            feedback && React.createElement('div', { className: "bg-red-900/50 border border-red-500 text-red-200 p-3 rounded mb-4 text-center animate-bounce" }, feedback),
                            
                            // Trap Buttons
                            React.createElement('div', { className: "grid grid-cols-1 md:grid-cols-3 gap-6 mb-8" },
                                React.createElement('button', {
                                    onClick: () => handleTrapClick('FIGHT'),
                                    className: "h-32 bg-red-700 hover:bg-red-600 rounded-xl flex flex-col items-center justify-center gap-2 border-b-8 border-red-900 active:border-b-0 active:translate-y-2 transition-all group"
                                },
                                    React.createElement(ShieldAlert, { size: 40 }),
                                    React.createElement('span', { className: "text-2xl font-black" }, " (FIGHT)"),
                                    React.createElement('span', { className: "text-xs opacity-0 group-hover:opacity-100" }, "转 住拽转")
                                ),
                                React.createElement('button', {
                                    onClick: () => handleTrapClick('FLIGHT'),
                                    className: "h-32 bg-orange-700 hover:bg-orange-600 rounded-xl flex flex-col items-center justify-center gap-2 border-b-8 border-orange-900 active:border-b-0 active:translate-y-2 transition-all group"
                                },
                                    React.createElement(Wind, { size: 40 }),
                                    React.createElement('span', { className: "text-2xl font-black" }, "专 (FLIGHT)"),
                                    React.createElement('span', { className: "text-xs opacity-0 group-hover:opacity-100" }, "转 住拽转")
                                ),
                                React.createElement('button', {
                                    onClick: () => handleTrapClick('FREEZE'),
                                    className: "h-32 bg-blue-900 hover:bg-blue-800 rounded-xl flex flex-col items-center justify-center gap-2 border-b-8 border-blue-950 active:border-b-0 active:translate-y-2 transition-all group"
                                },
                                    React.createElement(Lock, { size: 40 }),
                                    React.createElement('span', { className: "text-2xl font-black" }, "拽驻 (FREEZE)"),
                                    React.createElement('span', { className: "text-xs opacity-0 group-hover:opacity-100" }, "转 住拽转")
                                )
                            ),
                            React.createElement('div', { className: "text-center" },
                                React.createElement('button', {
                                    onClick: activateCortex,
                                    className: "text-xl font-bold text-white bg-blue-600 hover:bg-blue-500 mt-8 px-8 py-4 rounded-full shadow-[0_0_20px_rgba(59,130,246,0.6)] border-4 border-blue-400 transition-all transform hover:scale-105"
                                }, "[  专: 驻注转 拽专拽住 转 - 转 砖 专砖转 ]")
                            )
                        ),

                        // Regulation Phase
                        gameState === 'regulation' && React.createElement('div', { className: "p-2" },
                            React.createElement('div', { className: "flex justify-between items-center mb-4" },
                                React.createElement('h2', { className: "text-2xl font-bold text-blue-400 flex items-center gap-2" },
                                    React.createElement(Brain, { size: 24 }),
                                    "驻专拽 住转: 砖 专砖转 (Labeling)"
                                )
                            ),
                            React.createElement('p', { className: "mb-6 text-slate-300 bg-slate-700/50 p-4 rounded border-r-4 border-blue-500" },
                                React.createElement('strong', null, "砖:"), "  转 10 专砖转 转住住 注  专 拽爪专. 注 住 驻 砖专 注 -0."
                            ),
                            // 砖 :  转 专专  驻 转 专 砖砖 驻拽 专拽,  砖专 注  拽注 注 拽驻爪转
                            React.createElement('div', { 
                                className: `p-2 rounded mb-4 text-center sticky top-0 z-10 font-bold min-h-[3.5rem] flex items-center justify-center transition-all ${feedback ? (feedback.includes('') ? 'bg-green-900/50 text-green-200' : 'bg-yellow-900/50 text-yellow-200') : 'invisible'}` 
                            }, feedback || "placeholder"),
                            
                            React.createElement('div', { className: "grid grid-cols-2 md:grid-cols-5 gap-4" },
                                challenges.map(challenge => {
                                    const isSolved = answeredQuestions.includes(challenge.id);
                                    return React.createElement('div', {
                                        key: challenge.id,
                                        className: `relative p-3 rounded-xl border-2 transition-all duration-300 flex flex-col h-full ${isSolved ? 'border-green-500 bg-green-900/20 scale-95 opacity-80' : 'border-slate-600 bg-slate-700/30 hover:border-blue-400'}`
                                    },
                                        isSolved && React.createElement('div', { className: "absolute top-2 right-2 z-10" },
                                            React.createElement(CheckCircle, { className: "text-green-400 bg-slate-900 rounded-full", size: 28 })
                                        ),
                                        React.createElement('div', { className: "bg-slate-900/50 rounded-lg p-2 mb-3 flex justify-center items-center h-20 shadow-inner" },
                                            React.createElement('span', { className: "text-5xl filter drop-shadow-lg", role: "img", "aria-label": challenge.correctOption }, challenge.visual)
                                        ),
                                        React.createElement('div', { className: "flex-grow space-y-1" },
                                            React.createElement('div', { className: "flex items-center gap-1 text-blue-300 font-bold text-xs" },
                                                challenge.icon,
                                                React.createElement('h3', { className: "leading-tight" }, challenge.title)
                                            ),
                                            React.createElement('div', { className: "text-[10px] text-slate-400 italic bg-slate-800 p-1 rounded border-r-2 border-slate-600 h-10 overflow-hidden" }, challenge.quote)
                                        ),
                                        React.createElement('div', { className: "mt-2 pt-2 border-t border-slate-600/50" },
                                            !isSolved ? React.createElement('div', { className: "grid grid-cols-1 gap-1" },
                                                challenge.options.map(option =>
                                                    React.createElement('button', {
                                                        key: option,
                                                        onClick: () => handleAnswer(challenge.id, option, challenge.correctOption),
                                                        className: "px-1 py-1 bg-slate-600 hover:bg-blue-600 rounded text-[11px] font-medium transition-colors text-right"
                                                    }, option)
                                                )
                                            ) : React.createElement('div', { className: "text-center text-green-400 font-bold py-1 border border-green-500/30 rounded bg-green-500/10 text-xs" },
                                                `${challenge.correctOption} -  `
                                            )
                                        )
                                    );
                                })
                            )
                        )
                    )
                ),

                // Success Screen
                gameState === 'success' && React.createElement('div', { className: "max-w-2xl w-full bg-green-900/90 p-8 rounded-xl shadow-2xl border-4 border-green-500 text-center space-y-6 animate-in fade-in zoom-in duration-500" },
                    React.createElement('div', { className: "flex justify-center mb-4" },
                        React.createElement(Activity, { size: 80, className: "text-green-400" })
                    ),
                    React.createElement('h1', { className: "text-4xl font-bold text-white" }, "注专转 专 爪!"),
                    React.createElement('div', { className: "bg-black/30 p-4 rounded-lg text-left rtl:text-right" },
                        React.createElement('h3', { className: "font-bold text-green-300 text-xl mb-2" }, "住 专注:"),
                        React.createElement('ul', { className: "space-y-2 text-green-100 list-disc list-inside" },
                            React.createElement('li', null, "  \"注拽转 砖\"."),
                            React.createElement('li', null, "砖 10 专砖转  转 祝 爪."),
                            React.createElement('li', null, "砖 专  爪转 (Prefrontal Cortex).")
                        )
                    ),
                    React.createElement('p', { className: "text-lg text-white font-bold" },
                        "拽 砖专专 砖  : ",
                        React.createElement('span', { className: "text-3xl bg-white text-green-900 px-3 py-1 rounded mx-2" }, "5-3-7")
                    ),
                    React.createElement('button', {
                        onClick: () => setGameState('intro'),
                        className: "mt-4 px-6 py-2 bg-green-700 hover:bg-green-600 rounded text-white"
                    }, "转 住爪")
                ),

                // Fail Screen
                gameState === 'fail' && React.createElement('div', { className: "max-w-2xl w-full bg-red-900 p-8 rounded-xl text-center space-y-6" },
                    React.createElement(XCircle, { size: 80, className: "text-red-300 mx-auto" }),
                    React.createElement('h1', { className: "text-4xl font-bold text-white" }, "注专转 拽专住"),
                    React.createElement('p', { className: "text-xl text-red-100" }, " 砖转 .  爪注 住转 ."),
                    React.createElement('button', {
                        onClick: handleStart,
                        className: "px-6 py-2 bg-white text-red-900 font-bold rounded hover:bg-gray-200"
                    }, "住 砖")
                ),

                React.createElement('div', { className: "mt-8 text-slate-500 text-xs text-center max-w-lg" },
                    "驻转 注专 拽专住 转驻住转 驻转 砖转 | 砖:   专砖转"
                )
            );
        };

        const root = createRoot(document.getElementById('root'));
        root.render(React.createElement(AmygdalaEscapeRoom));
    </script>
</body>
</html>

